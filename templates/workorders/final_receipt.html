<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>İş Emri Teslim Fişi</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; font-size: 12px; }
    .box { border: 2px solid #000; padding: 16px; max-width: 520px; }
    .title { font-size: 18px; font-weight: 700; margin-bottom: 10px; }
    .row { margin: 6px 0; }
    .k { display: inline-block; width: 140px; font-weight: 700; }
    .muted { color:#444; }
    .line { border-bottom: 1px solid #000; height: 20px; margin-top: 8px; }
    @media print { .btns { display:none; } body{ margin:0; } }
  </style>
</head>
<body>

<div class="btns" style="margin-bottom:10px;">
  <button onclick="window.print()">Yazdır</button>
  <a href="/workorders/" style="margin-left:10px;">Geri</a>
</div>

<div class="box">
  <div class="title">İş Emri Teslim Fişi (Kesin)</div>

  <div class="row"><span class="k">İş Emri #:</span> {{ o.id }}</div>
  <div class="row"><span class="k">Teslim Tarihi:</span> {% if o.finished_at %}{{ o.finished_at|date:"d.m.Y H:i" }}{% else %}-{% endif %}</div>
  <div class="row"><span class="k">Plaka:</span> {{ o.plate_text|default:o.vehicle.plate }}</div>
  <div class="row"><span class="k">Tür:</span> {{ o.get_kind_display }}</div>
  <div class="row"><span class="k">Durum:</span> {{ o.get_status_display }}</div>

  <hr />

  <div class="row"><span class="k">Müşteri:</span> {% if o.customer %}{{ o.customer.full_name }}{% else %}-{% endif %}</div>
  <div class="row"><span class="k">Telefon:</span> {% if o.customer %}{{ o.customer.phone|default:"-" }}{% else %}-{% endif %}</div>

  <hr />

  <div class="row"><span class="k">Konu:</span> {{ o.subject|default:"-" }}</div>

  <div class="row"><span class="k">Usta Notu:</span></div>
  <div class="row muted" style="white-space:pre-wrap;">{{ o.staff_note|default:"-" }}</div>

  <hr />

  <!-- Kesin fiyat: Bitir ile girilen değerler -->
  <div class="row"><span class="k">İşçilik:</span> {{ o.labor_total|default:"0" }} ₺</div>
  <div class="row"><span class="k">Parça:</span> {{ o.parts_total|default:"0" }} ₺</div>
  <div class="row"><span class="k">Genel Toplam:</span> <b>{{ o.grand_total|default:"0" }} ₺</b></div>

  <div class="row"><span class="k">Ödeme:</span> {{ o.payment_method|default:"-" }}</div>
  <div class="row"><span class="k">Ödendi:</span> {% if o.is_paid %}Evet{% else %}Hayır{% endif %}</div>

  <div class="row" style="margin-top:14px;"><span class="k">Müşteri İmza:</span></div>
  <div class="line"></div>

  <div class="row" style="margin-top:14px;"><span class="k">Yetkili İmza:</span></div>
  <div class="line"></div>
</div>

</body>
</html>
